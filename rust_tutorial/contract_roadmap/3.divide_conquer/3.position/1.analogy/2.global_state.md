目标：
1. Global state定义
2. Gloabal state 是如何存储精确的流动性，position fees等


内容：
1. 



2. global state存储了哪些变量？ 
it includes seven storage variable :
Type Variable Name Notation
uint128 liquidity 𝐿
uint160 sqrtPriceX96 √𝑃
int24 tick 𝑖𝑐
uint256 feeGrowthGlobal0X128 𝑓𝑔,0
uint256 feeGrowthGlobal1X128 𝑓𝑔,1
uint128 protocolFees.token0 𝑓𝑝,0
uint128 protocolFees.token1 𝑓𝑝,1


2.1 这些变量的作用
在uniswap v2中，每个池子 tracks 池子current reserves, x and y. 
在uniswap v3, 合约拥有 virtual reserves,它为x,y提供虚拟值。 

但是v3,并没有直接追踪virtual reserves。 它tracks 两个不同的值： liquidity(L) 和sqrtPrice(√𝑃). 
这两个值是如何计算的？
1.𝐿 =√𝑥y
2.√𝑃 =√y/x

虚拟储备计算公式：
x = L/√p 
y = L*√p 


2.2 L和√P 并不会同时变化
Price(√P) changes when swapping within a tick . 
liquidity changes when crossing a tick, or when minting or burning liquidity. 


2.3 Liquidity 在V2和V3中的区别
In Uniswap V2, liquidity was based on actual reserves (the amounts of tokens in the pool). But in Uniswap V3, liquidity is based on virtual reserves and is related to the price of assets.
具体区别1： Liquidity分配
v2: Liquidity is essentially the amount of assets provided in the pool. It is determined by how much of Token1 and Token2 are available for trading.
v3: In Uniswap V3, liquidity is concentrated, meaning it is only available in a specific price range rather than being spread out evenly across the entire price spectrum.

virutal reserves的作用：
Virtual reserves are calculated reserves that are used to represent the amount of liquidity in the pool. These reserves are based on the price and are not tied to actual tokens in the pool but represent how the liquidity changes with price movements.
The term virtual reserves means that these values don't directly represent the actual number of tokens in the pool, but they are used to calculate the amount of liquidity available in the system.


Liquidity Tokens的作用
whole range : In Uniswap V2, liquidity providers receive liquidity tokens as proof of their share in the pool. The amount of liquidity tokens they receive depends on the amount of reserves (Token1 and Token2) they provide relative to the total reserves in the pool.
specific price range: In Uniswap V3, liquidity is not tied to just the total reserves but to a specific price range. As a result, liquidity can also be thought of as virtual liquidity tokens. These are not traditional tokens but represent the proportional share of liquidity available at a specific price range.


2.4 L与变化的关系？ （change in  reserves and price）
𝐿 = Δ𝑌/Δ√P
示例:
Let’s walk through a simple example.

Step 1: Initial Setup
Price: 1 Token1 = 100 Token2

Reserve of Token1 (Y): 1000 Token1

Reserve of Token2: 100,000 Token2

Step 2: Change in Reserves (ΔY)
Let’s say a trade occurs and you swap 100 Token1 for 10,000 Token2.

ΔY is the change in Token1's reserve.

Before the trade: 1000 Token1 in the pool.

After the trade: 900 Token1 in the pool.

ΔY = 1000 - 900 = 100 Token1.

Step 3: Change in Price (Δ√P)
Suppose that the price of Token1 changes slightly after the trade. The price increases from 1 Token1 = 100 Token2 to 1 Token1 = 101 Token2.

Δ√P is the change in the square root of the price.

Before the trade, the price was √P = √100 = 10.

After the trade, the price is √P = √101 ≈ 10.05.

Δ√P = 10.05 - 10 = 0.05.

Step 4: Calculate Liquidity (L)
Now, we can calculate the liquidity using the formula:

𝐿
=
Δ
𝑌
Δ
𝑃
=
100
0.05
=
2000
L= 
Δ 
P
​
 
ΔY
​
 = 
0.05
100
​
 =2000
So, the liquidity L that corresponds to this price range (from 100 Token1 = 100 Token2 to 101 Token1 = 101 Token2) is 2000.

Conclusion:
ΔY represents the change in the reserve of Token1 as the price changes.

Δ√P represents the change in the square root of the price due to market movements.

Using these values, the formula 
𝐿
=
Δ
𝑌
Δ
𝑃
L= 
Δ 
P
​
 
ΔY
​
  calculates the liquidity available in the pool, allowing us to understand how much liquidity is available at specific price ranges in Uniswap V3.


