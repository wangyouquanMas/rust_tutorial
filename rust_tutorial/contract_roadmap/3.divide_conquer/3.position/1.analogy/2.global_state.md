ç›®æ ‡ï¼š
1. Global stateå®šä¹‰
2. Gloabal state æ˜¯å¦‚ä½•å­˜å‚¨ç²¾ç¡®çš„æµåŠ¨æ€§ï¼Œposition feesç­‰


å†…å®¹ï¼š
1. 



2. global stateå­˜å‚¨äº†å“ªäº›å˜é‡ï¼Ÿ 
it includes seven storage variable :
Type Variable Name Notation
uint128 liquidity ğ¿
uint160 sqrtPriceX96 âˆšğ‘ƒ
int24 tick ğ‘–ğ‘
uint256 feeGrowthGlobal0X128 ğ‘“ğ‘”,0
uint256 feeGrowthGlobal1X128 ğ‘“ğ‘”,1
uint128 protocolFees.token0 ğ‘“ğ‘,0
uint128 protocolFees.token1 ğ‘“ğ‘,1


2.1 è¿™äº›å˜é‡çš„ä½œç”¨
åœ¨uniswap v2ä¸­ï¼Œæ¯ä¸ªæ± å­ tracks æ± å­current reserves, x and y. 
åœ¨uniswap v3, åˆçº¦æ‹¥æœ‰ virtual reserves,å®ƒä¸ºx,yæä¾›è™šæ‹Ÿå€¼ã€‚ 

ä½†æ˜¯v3,å¹¶æ²¡æœ‰ç›´æ¥è¿½è¸ªvirtual reservesã€‚ å®ƒtracks ä¸¤ä¸ªä¸åŒçš„å€¼ï¼š liquidity(L) å’ŒsqrtPrice(âˆšğ‘ƒ). 
è¿™ä¸¤ä¸ªå€¼æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ
1.ğ¿ =âˆšğ‘¥y
2.âˆšğ‘ƒ =âˆšy/x

è™šæ‹Ÿå‚¨å¤‡è®¡ç®—å…¬å¼ï¼š
x = L/âˆšp 
y = L*âˆšp 


2.2 Lå’ŒâˆšP å¹¶ä¸ä¼šåŒæ—¶å˜åŒ–
Price(âˆšP) changes when swapping within a tick . 
liquidity changes when crossing a tick, or when minting or burning liquidity. 


2.3 Liquidity åœ¨V2å’ŒV3ä¸­çš„åŒºåˆ«
In Uniswap V2, liquidity was based on actual reserves (the amounts of tokens in the pool). But in Uniswap V3, liquidity is based on virtual reserves and is related to the price of assets.
å…·ä½“åŒºåˆ«1ï¼š Liquidityåˆ†é…
v2: Liquidity is essentially the amount of assets provided in the pool. It is determined by how much of Token1 and Token2 are available for trading.
v3: In Uniswap V3, liquidity is concentrated, meaning it is only available in a specific price range rather than being spread out evenly across the entire price spectrum.

virutal reservesçš„ä½œç”¨ï¼š
Virtual reserves are calculated reserves that are used to represent the amount of liquidity in the pool. These reserves are based on the price and are not tied to actual tokens in the pool but represent how the liquidity changes with price movements.
The term virtual reserves means that these values don't directly represent the actual number of tokens in the pool, but they are used to calculate the amount of liquidity available in the system.


Liquidity Tokensçš„ä½œç”¨
whole range : In Uniswap V2, liquidity providers receive liquidity tokens as proof of their share in the pool. The amount of liquidity tokens they receive depends on the amount of reserves (Token1 and Token2) they provide relative to the total reserves in the pool.
specific price range: In Uniswap V3, liquidity is not tied to just the total reserves but to a specific price range. As a result, liquidity can also be thought of as virtual liquidity tokens. These are not traditional tokens but represent the proportional share of liquidity available at a specific price range.


2.4 Lä¸å˜åŒ–çš„å…³ç³»ï¼Ÿ ï¼ˆchange in  reserves and priceï¼‰
ğ¿ = Î”ğ‘Œ/Î”âˆšP
ç¤ºä¾‹:
Letâ€™s walk through a simple example.

Step 1: Initial Setup
Price: 1 Token1 = 100 Token2

Reserve of Token1 (Y): 1000 Token1

Reserve of Token2: 100,000 Token2

Step 2: Change in Reserves (Î”Y)
Letâ€™s say a trade occurs and you swap 100 Token1 for 10,000 Token2.

Î”Y is the change in Token1's reserve.

Before the trade: 1000 Token1 in the pool.

After the trade: 900 Token1 in the pool.

Î”Y = 1000 - 900 = 100 Token1.

Step 3: Change in Price (Î”âˆšP)
Suppose that the price of Token1 changes slightly after the trade. The price increases from 1 Token1 = 100 Token2 to 1 Token1 = 101 Token2.

Î”âˆšP is the change in the square root of the price.

Before the trade, the price was âˆšP = âˆš100 = 10.

After the trade, the price is âˆšP = âˆš101 â‰ˆ 10.05.

Î”âˆšP = 10.05 - 10 = 0.05.

Step 4: Calculate Liquidity (L)
Now, we can calculate the liquidity using the formula:

ğ¿
=
Î”
ğ‘Œ
Î”
ğ‘ƒ
=
100
0.05
=
2000
L= 
Î” 
P
â€‹
 
Î”Y
â€‹
 = 
0.05
100
â€‹
 =2000
So, the liquidity L that corresponds to this price range (from 100 Token1 = 100 Token2 to 101 Token1 = 101 Token2) is 2000.

Conclusion:
Î”Y represents the change in the reserve of Token1 as the price changes.

Î”âˆšP represents the change in the square root of the price due to market movements.

Using these values, the formula 
ğ¿
=
Î”
ğ‘Œ
Î”
ğ‘ƒ
L= 
Î” 
P
â€‹
 
Î”Y
â€‹
  calculates the liquidity available in the pool, allowing us to understand how much liquidity is available at specific price ranges in Uniswap V3.


