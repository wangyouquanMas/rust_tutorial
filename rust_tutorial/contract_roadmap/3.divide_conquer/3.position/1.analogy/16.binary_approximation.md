# Binary Search 算法及其在计算分数值中的应用

## 目标
0. 基本概念
1. 理解什么是Binary Search
2. 理解Binary Search在计算 fractional value中的作用

## 内容


0. 基本概念 Binary logarithm approximation





### 1. 什么是Binary Search

Binary search是一种高效的搜索算法。虽然它通常用于在排序集合中查找特定值，但也可以应用于近似值计算，例如查找对数的小数部分。

**Binary search的前提是：范围必须是有序的（the range is sorted）**

**核心思想：**
- 在每一步中，检查目标值是否大于或小于范围的中间值
- 然后丢弃一半的范围（左侧或右侧），并对剩余范围重复此过程
- 这种方法在每一步都将可能性数量减半，使其极其高效

### 2. 理解其在计算fractional value中的作用

#### 2.1 什么是计算范围？
范围为 [1, 2)

**为什么选择[1, 2)作为范围？**
如果将值标准化到范围[1, 2)，则其整数部分始终为0，这简化了小数部分的计算。

#### 2.2 二的幂的对数特性
当输入在[1, 2)范围内时，对数计算表现良好。在这种情况下：

- log₂(1) = 0（因为1 = 2⁰）
- log₂(2) = 1（因为2 = 2¹）

通过标准化到[1, 2)，可以确保数字的对数将具有0到1之间的小数部分，这更容易通过迭代方法近似计算。

这种标准化使对数计算与尺度无关，并将问题转化为更易于管理的范围。

#### 2.3 什么是目标值？
目标值是 r*r

#### 2.4 什么是中点值？
中点值是2

**为什么设置目标值为2？**

### 理解为什么当r² > 2时，小数部分"太大"

#### 目标：
计算r的对数的**小数部分**，其中r是范围[1, 2)内的标准化数字。我们使用**以2为底的对数**，所以：

$$
\log_2(r) = \text{整数部分} + \text{小数部分}
$$

对于1到2之间的数字，**整数部分**始终为0，因此我们只关心**小数部分**。

#### 核心思想：
当我们计算$\log_2(r)$的**小数部分**时，我们处理的是标准化值$r \in [1, 2)$。这意味着：

* **$\log_2(1) = 0$**
* **$\log_2(2) = 1$**

对数的**小数部分**始终在**0**和**1**之间。

#### 为什么将$r^2$与2进行比较？
在使用以2为底的**对数**时，我们通过细化小数部分来近似$\log_2(r)$。为此，我们将r**平方**并与**2**进行比较。

这个过程类似于**二分查找**，用于**放大**对数的正确小数部分。

#### 以$r = 1.5$为例的步骤说明：

1. **初始值**：$r = 1.5$
   * **平方r**：$r^2 = 1.5^2 = 2.25$

2. **比较$r^2$与2**：
   * $r^2 = 2.25$ **大于2**。
   * 这意味着**$\log_2(1.5)$的小数部分太大**。

#### 为什么$r^2 > 2$被认为"太大"？

关键在于：
* 范围$[1, 2)$内任何数字的**对数值**具有**在0和1之间**的小数部分。
* 当我们平方r并得到**大于2**的值时，表明我们对对数小数部分的**当前猜测太高**。

从对数函数的角度思考：
* **$\log_2(1) = 0$**
* **$\log_2(2) = 1$**

如果你处理的是**1和2之间**的数字，$\log_2(r)$的小数部分应该**小于1**。平方过程是**近似2的幂**的一种方式，如果得到的平方值**大于2**，意味着你**过度估计**了，计算的小数部分**太大**。

例如，当$r = 1.5$时，我们知道：
* 1.5的正确**对数**（以2为底）**约为0.58496**。
* $\log_2(1.5)$的小数部分约为0.58496，明显**小于1**。

但当你平方$r = 1.5$时，得到2.25，这**大于2**。这**太大**了，因为对数的小数部分必须在0和1之间。

#### 如何缩小范围？

由于$r^2$太大，我们需要通过**缩小范围**来调整**近似值**。方法如下：

1. **如果$r^2 > 2$**：
   * $\log_2(r)$的小数部分太大。
   * 要**缩小范围**，我们**减小$r$**。通常通过**将$r$减半**或向下移动值来完成。
   * 通过减小$r$，我们使近似值更接近正确的小数部分。

2. **如果$r^2 < 2$**：
   * $\log_2(r)$的小数部分太小。
   * 我们**增加$r$**来调整近似值。

#### 过程可视化

帮助理解：
* 如果**$r^2 > 2$**，我们知道$r$**太大**。要修正这一点，我们减小$r$使其更接近正确值。
  例如，如果$r = 1.5$，我们会减小$r$（例如，将其减半至$0.75$）并继续该过程，以缩小到正确值。

* 如果**$r^2 < 2$**，意味着$r$**太小**，所以我们会**增加**$r$（或向上调整）以更接近正确值。

#### 总结：
* 当$r^2 > 2$时，意味着**对数的小数部分太大**，因为对于**1和2之间**的数字，**$\log_2(r)$的小数部分**应始终小于**1**。
* 要修正这一点，我们通过减小$r$来**缩小范围**。
* 通过重复调整$r$并将其平方，我们可以细化$\log_2(r)$的**小数部分**的近似值。

### 2.5 当r² > 2或r² < 2时，如何缩减范围？

**通过位移缩小范围：**

缩小范围的关键操作是根据平方值是大于还是小于2，将r左移63或64位。这种位移操作逐步减小或增加r的近似值。

操作`r >>= 63 + is_r_more_than_two`意味着：

* 如果$r^2 \geq 2$，将$r$右移64位（实际上是将$r$减半）。
* 如果$r^2 < 2$，将$r$右移63位，保持其较大并细化小数部分。